{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"D:\\\\angular\\\\hts_reactnative\\\\src\\\\app\\\\screens\\\\details\\\\TabManagement\\\\BookingSystem\\\\ReportBookingSystem.tsx\";\n\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useState, useEffect } from \"react\";\nimport View from \"react-native-web/dist/exports/View\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport ScrollView from \"react-native-web/dist/exports/ScrollView\";\nimport { colors } from \"../../../../utils/Colors\";\nimport PickerModel from \"../../../../components/picker/PickerModel\";\nimport DateTimePicker from \"../../../../components/datetimepicker\";\nimport { Table, Row } from \"react-native-table-component\";\nimport { GetMemberFilter } from \"../../../../netWorking/memberService\";\nimport { getListBooking } from \"../../../../netWorking/bookingService\";\nimport { getTransactionPayment } from \"../../../../netWorking/transactionService\";\nimport DialogAwait from \"../../../../components/dialogs/dialogAwait\";\nimport moment from \"moment\";\nimport { Money } from \"../../../../components/generalConvert/conVertmunberToMoney\";\n\nvar ReportBookingSystem = function ReportBookingSystem() {\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      isLoading = _useState2[0],\n      setIsLoading = _useState2[1];\n\n  var outletModel = [{\n    label: \"Spa\",\n    value: 1\n  }, {\n    label: \"Ola Restaurant\",\n    value: 2\n  }];\n\n  var _useState3 = useState(2),\n      _useState4 = _slicedToArray(_useState3, 2),\n      outlet = _useState4[0],\n      setOutlet = _useState4[1];\n\n  var onchangeOutlet = function onchangeOutlet(data) {\n    return _regeneratorRuntime.async(function onchangeOutlet$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            setOutlet(data);\n\n          case 1:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var _useState5 = useState(moment(new Date().setDate(new Date().getDate() - 1)).format(\"YYYY-MM-DD\")),\n      _useState6 = _slicedToArray(_useState5, 2),\n      fromDateTime = _useState6[0],\n      setFromDateTime = _useState6[1];\n\n  var _useState7 = useState(moment(new Date().setDate(new Date().getDate())).format(\"YYYY-MM-DD\")),\n      _useState8 = _slicedToArray(_useState7, 2),\n      endDateTime = _useState8[0],\n      setEndDateTime = _useState8[1];\n\n  var _useState9 = useState([]),\n      _useState10 = _slicedToArray(_useState9, 2),\n      bookingList = _useState10[0],\n      setBookingList = _useState10[1];\n\n  var _useState11 = useState({}),\n      _useState12 = _slicedToArray(_useState11, 2),\n      memberBooking = _useState12[0],\n      setMemberBooking = _useState12[1];\n\n  var loadInfoMember = function loadInfoMember(memCode) {\n    var res;\n    return _regeneratorRuntime.async(function loadInfoMember$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return _regeneratorRuntime.awrap(GetMemberFilter(memCode));\n\n          case 2:\n            res = _context2.sent;\n\n            if (!(res.isSuccess == 1 && res.data)) {\n              _context2.next = 7;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", res.data[0]);\n\n          case 7:\n            return _context2.abrupt(\"return\", null);\n\n          case 8:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var loadBookingList = function loadBookingList() {\n    var res, dataList, memberList, memberInfos, infos, memberPayment, payments;\n    return _regeneratorRuntime.async(function loadBookingList$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            setBookingList([]);\n            _context3.next = 3;\n            return _regeneratorRuntime.awrap(getListBooking(fromDateTime, endDateTime, null, null));\n\n          case 3:\n            res = _context3.sent;\n            dataList = [];\n            memberList = [];\n\n            if (!(res.isSuccess == 1 && res.data)) {\n              _context3.next = 20;\n              break;\n            }\n\n            dataList = res.data;\n            dataList.map(function (item) {\n              if (item.memCode) {\n                var member = memberList.find(function (i) {\n                  return i[\"id\"] == item.memCode;\n                });\n\n                if (!member) {\n                  memberList.push({\n                    id: item.memCode,\n                    data: [item]\n                  });\n                } else {\n                  var objIndex = memberList.findIndex(function (obj) {\n                    return obj.id == item.memCode;\n                  });\n                  memberList[objIndex].data.push(item);\n                }\n              }\n            });\n            memberInfos = memberList.map(function (t) {\n              return loadInfoMember(t[\"id\"]);\n            });\n            _context3.next = 12;\n            return _regeneratorRuntime.awrap(Promise.all(memberInfos));\n\n          case 12:\n            infos = _context3.sent;\n            memberList.map(function (t) {\n              var info = infos.find(function (i) {\n                return i.memberMemCode == t.id;\n              });\n              var objIndex = memberList.findIndex(function (obj) {\n                return obj.id == info.memberMemCode;\n              });\n\n              if (info) {\n                memberList[objIndex].data[0].fullName = info.memberLastName;\n              }\n            });\n            memberPayment = memberList.map(function (t) {\n              return getTransactionPayment(fromDateTime, endDateTime, t[\"id\"], null);\n            });\n            _context3.next = 17;\n            return _regeneratorRuntime.awrap(Promise.all(memberPayment));\n\n          case 17:\n            payments = _context3.sent;\n            memberList.forEach(function (t, i) {\n              payments.forEach(function (payment, index) {\n                if (i === index) {\n                  t[\"revenue\"] = payment.data;\n                }\n              });\n            });\n            setMemberBooking(memberList);\n\n          case 20:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  useEffect(function () {\n    loadBookingList();\n  }, [fromDateTime, endDateTime]);\n\n  var handleDataTable = function handleDataTable(item) {\n    var _Money;\n\n    var countCancel = 0;\n    var countRevenue = 0;\n    item.data.map(function (item) {\n      if (item.isActive === 0) {\n        countCancel++;\n      }\n    });\n    item.revenue.map(function (item) {\n      if (item.tender !== 0) {\n        countRevenue = countRevenue + item.tender;\n      }\n    });\n    return [item.data[0].fullName, item.data.length, countCancel, (_Money = Money(Math.round(countRevenue))) != null ? _Money : 0];\n  };\n\n  return React.createElement(View, {\n    style: styles.container,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 5\n    }\n  }, React.createElement(ScrollView, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 7\n    }\n  }, React.createElement(PickerModel, {\n    data: outletModel,\n    defaultValue: \"Ola Restaurant\",\n    onSelectedValue: function onSelectedValue(value) {\n      onchangeOutlet(value.value);\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 9\n    }\n  }), React.createElement(View, {\n    style: styles.line,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 9\n    }\n  }), React.createElement(DateTimePicker, {\n    onSubmitFromDate: function onSubmitFromDate(date) {\n      return setFromDateTime(moment(date).format(\"YYYY-MM-DD\"));\n    },\n    onSubmitEndDate: function onSubmitEndDate(date) {\n      return setEndDateTime(moment(date).format(\"YYYY-MM-DD\"));\n    },\n    fromDate: fromDateTime,\n    endDate: endDateTime,\n    isShowTime: false,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 9\n    }\n  }), React.createElement(View, {\n    style: {\n      paddingHorizontal: 15,\n      marginBottom: 10\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 9\n    }\n  }, React.createElement(View, {\n    style: styles.titleHeader,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 11\n    }\n  }, React.createElement(Text, {\n    style: [styles.textTitleHeader, {\n      textAlign: \"center\"\n    }],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 13\n    }\n  }, \"REPORT BOOKING SYSTEM\"))), React.createElement(ScrollView, {\n    horizontal: true,\n    style: {\n      paddingLeft: 15\n    },\n    indicatorStyle: \"white\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 9\n    }\n  }, React.createElement(View, {\n    style: {\n      backgroundColor: \"#414141\",\n      borderRadius: 4,\n      marginRight: 30\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 11\n    }\n  }, React.createElement(Table, {\n    style: {\n      borderRadius: 4\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 13\n    }\n  }, React.createElement(Row, {\n    data: [\"Customer\", \"Number of book\", \"Number of cancel\", \"Revenue\"],\n    style: {\n      borderTopLeftRadius: 4,\n      borderTopRightRadius: 4,\n      height: 36,\n      backgroundColor: \"#878787\",\n      paddingLeft: 10,\n      alignItems: \"center\"\n    },\n    widthArr: [150, 150, 150, 150],\n    textStyle: [styles.text12, {\n      alignSelf: \"center\"\n    }],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 15\n    }\n  }), Object.values(memberBooking).map(function (item, index) {\n    return React.createElement(Row, {\n      key: index,\n      data: handleDataTable(item),\n      style: [styles.styleRowTable, {\n        paddingLeft: 10,\n        paddingVertical: 4\n      }, index % 2 !== 0 && {\n        backgroundColor: \"#8D7550\"\n      }],\n      widthArr: [150, 150, 150, 150],\n      textStyle: [styles.textTitleHeader400, {\n        alignSelf: \"center\"\n      }],\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 19\n      }\n    });\n  }))))), React.createElement(DialogAwait, {\n    isShow: isLoading,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 7\n    }\n  }));\n};\n\nexport default ReportBookingSystem;\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: colors.backgroundApp\n  },\n  line: {\n    height: 10,\n    backgroundColor: colors.backgroundTab\n  },\n  text16: {\n    color: colors.colorText,\n    fontWeight: \"500\",\n    fontSize: 16\n  },\n  textGray: {\n    color: colors.colorLine,\n    fontWeight: \"400\",\n    fontSize: 14\n  },\n  titleHeader: {\n    paddingVertical: 16,\n    paddingHorizontal: 16,\n    borderBottomWidth: 1,\n    borderBottomColor: colors.colorLine\n  },\n  textTitleHeader: {\n    color: colors.colorText,\n    fontWeight: \"500\",\n    fontSize: 14\n  },\n  text12: {\n    color: colors.colorText,\n    fontWeight: \"400\",\n    fontSize: 12\n  },\n  styleRowTable: {\n    height: 36,\n    alignItems: \"center\"\n  },\n  textTitleHeader400: {\n    color: colors.colorText,\n    fontWeight: \"400\",\n    fontSize: 14\n  }\n});","map":{"version":3,"sources":["D:/angular/hts_reactnative/src/app/screens/details/TabManagement/BookingSystem/ReportBookingSystem.tsx"],"names":["React","useState","useEffect","colors","PickerModel","DateTimePicker","Table","Row","GetMemberFilter","getListBooking","getTransactionPayment","DialogAwait","moment","Money","ReportBookingSystem","isLoading","setIsLoading","outletModel","label","value","outlet","setOutlet","onchangeOutlet","data","Date","setDate","getDate","format","fromDateTime","setFromDateTime","endDateTime","setEndDateTime","bookingList","setBookingList","memberBooking","setMemberBooking","loadInfoMember","memCode","res","isSuccess","loadBookingList","dataList","memberList","map","item","member","find","i","push","id","objIndex","findIndex","obj","memberInfos","t","Promise","all","infos","info","memberMemCode","fullName","memberLastName","memberPayment","payments","forEach","payment","index","handleDataTable","countCancel","countRevenue","isActive","revenue","tender","length","Math","round","styles","container","line","date","paddingHorizontal","marginBottom","titleHeader","textTitleHeader","textAlign","paddingLeft","backgroundColor","borderRadius","marginRight","borderTopLeftRadius","borderTopRightRadius","height","alignItems","text12","alignSelf","Object","values","styleRowTable","paddingVertical","textTitleHeader400","StyleSheet","create","flex","backgroundApp","backgroundTab","text16","color","colorText","fontWeight","fontSize","textGray","colorLine","borderBottomWidth","borderBottomColor"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport {\r\n  View,\r\n  StyleSheet,\r\n  Text,\r\n  TouchableWithoutFeedback,\r\n  ScrollView,\r\n  TouchableOpacity,\r\n  TextInput,\r\n  KeyboardTypeOptions,\r\n  ImageProps,\r\n  Platform,\r\n  Dimensions,\r\n} from \"react-native\";\r\n\r\nimport { Icons, Images } from \"../../../../assets\";\r\nimport DropDownPickerLine from \"../../../../components/DropDownPickerLine\";\r\nimport { IModalPicker, Imodel } from \"../../../../models/Imodel\";\r\nimport { colors } from \"../../../../utils/Colors\";\r\nimport { Ionicons } from \"@expo/vector-icons\";\r\nimport PickerModel from \"../../../../components/picker/PickerModel\";\r\nimport DateTimePicker from \"../../../../components/datetimepicker\";\r\nimport { Table, Row } from \"react-native-table-component\";\r\nimport { GetMemberFilter } from \"../../../../netWorking/memberService\";\r\nimport { getListBooking } from \"../../../../netWorking/bookingService\";\r\nimport { bookingModel } from \"../../../../models/bookingModel\";\r\nimport { getTransactionDetail, getTransactionPayment } from \"../../../../netWorking/transactionService\";\r\nimport { transactionDetailModel, transactionPaymentModel } from \"../../../../models/transactionModel\";\r\nimport DialogAwait from \"../../../../components/dialogs/dialogAwait\";\r\nimport moment from \"moment\";\r\nimport { Money } from \"../../../../components/generalConvert/conVertmunberToMoney\";\r\nconst ReportBookingSystem = () => {\r\n  interface IMemberData {\r\n    id?: number;\r\n    data?: any[];\r\n    revenue?: any[];\r\n  }\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  // ----Outlet\r\n  const outletModel = [\r\n    { label: \"Spa\", value: 1 },\r\n    { label: \"Ola Restaurant\", value: 2 },\r\n  ];\r\n  const [outlet, setOutlet] = useState(2);\r\n  const onchangeOutlet = async (data: any) => {\r\n    setOutlet(data);\r\n  };\r\n\r\n  // -----DateTime picker\r\n\r\n  const [fromDateTime, setFromDateTime] = useState(moment(new Date().setDate(new Date().getDate() - 1)).format(\"YYYY-MM-DD\"));\r\n  const [endDateTime, setEndDateTime] = useState(moment(new Date().setDate(new Date().getDate())).format(\"YYYY-MM-DD\"));\r\n  //\r\n\r\n  const [bookingList, setBookingList] = useState([]);\r\n  const [memberBooking, setMemberBooking] = useState({});\r\n\r\n  const loadInfoMember = async memCode => {\r\n    const res = await GetMemberFilter(memCode);\r\n    if (res.isSuccess == 1 && res.data) {\r\n      return res.data[0];\r\n    } else return null;\r\n  };\r\n  const loadBookingList = async () => {\r\n    setBookingList([]);\r\n    const res = await getListBooking(fromDateTime, endDateTime, null, null);\r\n\r\n    let dataList = [];\r\n    let memberList: IMemberData[] = [];\r\n\r\n    if (res.isSuccess == 1 && res.data) {\r\n      dataList = res.data as bookingModel[];\r\n      dataList.map(item => {\r\n        if (item.memCode) {\r\n          const member = memberList.find(i => i[\"id\"] == item.memCode);\r\n          if (!member) {\r\n            memberList.push({ id: item.memCode, data: [item] });\r\n          } else {\r\n            let objIndex = memberList.findIndex(obj => obj.id == item.memCode);\r\n            memberList[objIndex].data.push(item);\r\n          }\r\n        }\r\n      });\r\n      const memberInfos = memberList.map(t => loadInfoMember(t[\"id\"]));\r\n      const infos = await Promise.all(memberInfos);\r\n      memberList.map(t => {\r\n        const info = infos.find(i => i.memberMemCode == t.id);\r\n        let objIndex = memberList.findIndex(obj => obj.id == info.memberMemCode);\r\n        if (info) {\r\n          // memberList[t][0].fullName = `${info.memberSalut ? info.memberSalut : \"\"} ${\r\n          //   info.memberFirstName ? info.memberFirstName : \"\"\r\n          // } ${info.memberLastName ? info.memberLastName : \"\"}`;\r\n          memberList[objIndex].data[0].fullName = info.memberLastName;\r\n        }\r\n      });\r\n      const memberPayment = memberList.map(t => getTransactionPayment(fromDateTime, endDateTime, t[\"id\"], null));\r\n      const payments = await Promise.all(memberPayment);\r\n      memberList.forEach((t, i) => {\r\n        payments.forEach((payment, index) => {\r\n          if (i === index) {\r\n            t[\"revenue\"] = payment.data;\r\n          }\r\n        });\r\n      });\r\n      setMemberBooking(memberList);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    loadBookingList();\r\n  }, [fromDateTime, endDateTime]);\r\n  const handleDataTable = (item: IMemberData[]) => {\r\n    let countCancel = 0;\r\n    let countRevenue = 0;\r\n    item.data.map(item => {\r\n      if (item.isActive === 0) {\r\n        countCancel++;\r\n      }\r\n    });\r\n    item.revenue.map(item => {\r\n      if (item.tender !== 0) {\r\n        countRevenue = countRevenue + item.tender;\r\n      }\r\n    });\r\n    return [item.data[0].fullName, item.data.length, countCancel, Money(Math.round(countRevenue)) ?? 0];\r\n  };\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <ScrollView>\r\n        {/* -----------------Picker Outlet------------- */}\r\n        <PickerModel\r\n          data={outletModel}\r\n          defaultValue=\"Ola Restaurant\"\r\n          onSelectedValue={value => {\r\n            onchangeOutlet(value.value);\r\n          }}\r\n        ></PickerModel>\r\n        {/* ----------------------------------------------- */}\r\n\r\n        <View style={styles.line}></View>\r\n        <DateTimePicker\r\n          onSubmitFromDate={date => setFromDateTime(moment(date).format(\"YYYY-MM-DD\"))}\r\n          onSubmitEndDate={date => setEndDateTime(moment(date).format(\"YYYY-MM-DD\"))}\r\n          fromDate={fromDateTime}\r\n          endDate={endDateTime}\r\n          isShowTime={false}\r\n        ></DateTimePicker>\r\n        {/* ---------------------------------------- */}\r\n        <View style={{ paddingHorizontal: 15, marginBottom: 10 }}>\r\n          <View style={styles.titleHeader}>\r\n            <Text style={[styles.textTitleHeader, { textAlign: \"center\" }]}>REPORT BOOKING SYSTEM</Text>\r\n          </View>\r\n        </View>\r\n        {/* ---------------------------------------- */}\r\n        <ScrollView horizontal style={{ paddingLeft: 15 }} indicatorStyle=\"white\">\r\n          <View\r\n            style={{\r\n              backgroundColor: \"#414141\",\r\n              borderRadius: 4,\r\n              marginRight: 30,\r\n            }}\r\n          >\r\n            <Table style={{ borderRadius: 4 }}>\r\n              <Row\r\n                data={[\"Customer\", \"Number of book\", \"Number of cancel\", \"Revenue\"]}\r\n                style={{\r\n                  borderTopLeftRadius: 4,\r\n                  borderTopRightRadius: 4,\r\n                  height: 36,\r\n                  backgroundColor: \"#878787\",\r\n                  paddingLeft: 10,\r\n                  alignItems: \"center\",\r\n                }}\r\n                widthArr={[150, 150, 150, 150]}\r\n                textStyle={[styles.text12, { alignSelf: \"center\" }]}\r\n              />\r\n              {Object.values(memberBooking).map((item, index) => {\r\n                return (\r\n                  <Row\r\n                    key={index}\r\n                    data={handleDataTable(item)}\r\n                    style={[\r\n                      styles.styleRowTable,\r\n                      { paddingLeft: 10, paddingVertical: 4 },\r\n                      index % 2 !== 0 && { backgroundColor: \"#8D7550\" },\r\n                    ]}\r\n                    widthArr={[150, 150, 150, 150]}\r\n                    textStyle={[styles.textTitleHeader400, { alignSelf: \"center\" }]}\r\n                  />\r\n                );\r\n              })}\r\n            </Table>\r\n          </View>\r\n        </ScrollView>\r\n      </ScrollView>\r\n      <DialogAwait isShow={isLoading}></DialogAwait>\r\n    </View>\r\n  );\r\n};\r\n\r\nexport default ReportBookingSystem;\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: colors.backgroundApp,\r\n  },\r\n  line: {\r\n    height: 10,\r\n    backgroundColor: colors.backgroundTab,\r\n  },\r\n  text16: {\r\n    color: colors.colorText,\r\n    fontWeight: \"500\",\r\n    fontSize: 16,\r\n  },\r\n  textGray: {\r\n    color: colors.colorLine,\r\n    fontWeight: \"400\",\r\n    fontSize: 14,\r\n  },\r\n\r\n  titleHeader: {\r\n    paddingVertical: 16,\r\n    paddingHorizontal: 16,\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: colors.colorLine,\r\n  },\r\n\r\n  textTitleHeader: {\r\n    color: colors.colorText,\r\n    fontWeight: \"500\",\r\n    fontSize: 14,\r\n  },\r\n  text12: {\r\n    color: colors.colorText,\r\n    fontWeight: \"400\",\r\n    fontSize: 12,\r\n  },\r\n  styleRowTable: {\r\n    height: 36,\r\n    alignItems: \"center\",\r\n  },\r\n  textTitleHeader400: {\r\n    color: colors.colorText,\r\n    fontWeight: \"400\",\r\n    fontSize: 14,\r\n  },\r\n});\r\n"]},"metadata":{},"sourceType":"module"}